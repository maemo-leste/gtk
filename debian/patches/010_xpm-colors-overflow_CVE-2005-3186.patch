diff -Nurp gtk+-2.8.6/gdk-pixbuf/io-xpm.c gtk+-2.8.6.new/gdk-pixbuf/io-xpm.c
--- gtk+-2.8.6/gdk-pixbuf/io-xpm.c	2005-03-08 03:59:45.000000000 +0000
+++ gtk+-2.8.6.new/gdk-pixbuf/io-xpm.c	2005-11-16 09:40:45.000000000 +0000
@@ -500,7 +500,9 @@ pixbuf_create_from_xpm (const gchar * (*
                              _("XPM has invalid number of chars per pixel"));
 		return NULL;
 	}
-	if (n_col <= 0 || n_col >= G_MAXINT / (cpp + 1)) {
+	if (n_col <= 0 || 
+	    n_col >= G_MAXINT / (cpp + 1) || 
+	    n_col >= G_MAXINT / sizeof (XPMColor)) {
                 g_set_error (error,
                              GDK_PIXBUF_ERROR,
                              GDK_PIXBUF_ERROR_CORRUPT_IMAGE,
